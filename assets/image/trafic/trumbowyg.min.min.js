jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1},writable:!1,enumerable:!0,configurable:!1}),function(g,h,f,p){"use strict";var d="tbwconfirm",c="tbwcancel",a=(p.fn.trumbowyg=function(e,t){var n="trumbowyg";if(e===Object(e)||!e)return this.each(function(){p(this).data(n)||p(this).data(n,new a(this,e))});if(1===this.length)try{var o=p(this).data(n);switch(e){case"execCmd":return o.execCmd(t.cmd,t.param,t.forceCss);case"openModal":return o.openModal(t.title,t.content);case"closeModal":return o.closeModal();case"openModalInsert":return o.openModalInsert(t.title,t.fields,t.callback);case"saveRange":return o.saveRange();case"getRange":return o.range;case"getRangeText":return o.getRangeText();case"restoreRange":return o.restoreRange();case"enable":return o.setDisabled(!1);case"disable":return o.setDisabled(!0);case"toggle":return o.toggle();case"destroy":return o.destroy();case"empty":return o.empty();case"html":return o.html(t)}}catch(e){}return!1},function(e,t){var n=this,o="trumbowyg-icons",a=p.trumbowyg,r=(n.doc=e.ownerDocument||f,n.$ta=p(e),n.$c=p(e),null!=(t=t||{}).lang||null!=a.langs[t.lang]?n.lang=p.extend(!0,{},a.langs.en,a.langs[t.lang]):n.lang=a.langs.en,n.hideButtonTexts=(null!=a.hideButtonTexts?a:t).hideButtonTexts,(null!=a.svgPath?a:t).svgPath);if(n.hasSvg=!1!==r,n.svgPath=n.doc.querySelector("base")?h.location.href.split("#")[0]:"",0===p("#"+o,n.doc).length&&!1!==r){if(null==r){for(var i=f.getElementsByTagName("script"),s=0;s<i.length;s+=1){var l=i[s].src,c=l.match("trumbowyg(.min)?.js");null!=c&&(r=l.substring(0,l.indexOf(c[0]))+"ui/icons.svg")}null==r&&console.warn("You must define svgPath: https://goo.gl/CfTY9U")}var d=n.doc.createElement("div");d.id=o,n.doc.body.insertBefore(d,n.doc.body.childNodes[0]),p.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:r,data:null,beforeSend:null,complete:null,success:function(e){d.innerHTML=(new XMLSerializer).serializeToString(e.documentElement)}})}function u(){return(h.chrome||h.Intl&&Intl.v8BreakIterator)&&"CSS"in h}o=n.lang.header;n.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable"},undo:{isSupported:u,key:"Z"},redo:{isSupported:u,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:o+" 1"},h2:{fn:"formatBlock",title:o+" 2"},h3:{fn:"formatBlock",title:o+" 3"},h4:{fn:"formatBlock",title:o+" 4"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},n.o=p.extend(!0,{},a.defaultOptions,t),n.o.hasOwnProperty("imgDblClickHandler")||(n.o.imgDblClickHandler=n.getDefaultImgDblClickHandler()),n.urlPrefix=n.setupUrlPrefix(),n.disabled=n.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,t.btns?n.o.btns=t.btns:n.o.semantic||(n.o.btns[3]=["bold","italic","underline","strikethrough"]),p.each(n.o.btnsDef,function(e,t){n.addBtnDef(e,t)}),n.eventNamespace="trumbowyg-event",n.keys=[],n.tagToButton={},n.tagHandlers=[],n.pasteHandlers=[].concat(n.o.pasteHandlers),n.isIE=-1!==g.userAgent.indexOf("MSIE")||-1!==g.appVersion.indexOf("Trident/"),n.init()});a.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var e=this;e.height=e.$ta.height(),e.initPlugins();try{e.doc.execCommand("enableObjectResizing",!1,!1),e.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){}e.buildEditor(),e.buildBtnPane(),e.fixedBtnPaneEvents(),e.buildOverlay(),setTimeout(function(){e.disabled&&e.setDisabled(!0),e.$c.trigger("tbwinit")})},addBtnDef:function(e,t){this.btnsDef[e]=t},setupUrlPrefix:function(){var e=this.o.urlProtocol;if(e)return"string"!=typeof e?"https://":/:\/\/$/.test(e)?e:e+"://"},buildEditor:function(){var o=this,t=o.o.prefix,e="";o.$box=p("<div/>",{class:t+"box "+t+"editor-visible "+t+o.o.lang+" trumbowyg"}),o.isTextarea=o.$ta.is("textarea"),o.isTextarea?(e=o.$ta.val(),o.$ed=p("<div/>"),o.$box.insertAfter(o.$ta).append(o.$ed,o.$ta)):(o.$ed=o.$ta,e=o.$ed.html(),o.$ta=p("<textarea/>",{name:o.$ta.attr("id"),height:o.height}).val(e),o.$box.insertAfter(o.$ed).append(o.$ta,o.$ed),o.syncCode()),o.$ta.addClass(t+"textarea").attr("tabindex",-1),o.$ed.addClass(t+"editor").attr({contenteditable:!0,dir:o.lang._dir||"ltr"}).html(e),o.o.tabindex&&o.$ed.attr("tabindex",o.o.tabindex),o.$c.is("[placeholder]")&&o.$ed.attr("placeholder",o.$c.attr("placeholder")),o.$c.is("[spellcheck]")&&o.$ed.attr("spellcheck",o.$c.attr("spellcheck")),o.o.resetCss&&o.$ed.addClass(t+"reset-css"),o.o.autogrow||o.$ta.add(o.$ed).css({height:o.height}),o.semanticCode(),o.o.autogrowOnEnter&&o.$ed.addClass(t+"autogrow-on-enter");var n,a=!1,r=!1;o.$ed.on("dblclick","img",o.o.imgDblClickHandler).on("keydown",function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey){a=!0;e=o.keys[String.fromCharCode(e.which).toUpperCase()];try{return o.execCmd(e.fn,e.param),!1}catch(e){}}}).on("compositionstart compositionupdate",function(){r=!0}).on("keyup compositionend",function(e){if("compositionend"===e.type)r=!1;else if(r)return;var t=e.which;37<=t&&t<=40||(!e.ctrlKey&&!e.metaKey||89!==t&&90!==t?a||17===t?void 0===e.which&&o.semanticCode(!1,!1,!0):(e=!o.isIE||"compositionend"===e.type,o.semanticCode(!1,e&&13===t),o.$c.trigger("tbwchange")):o.$c.trigger("tbwchange"),setTimeout(function(){a=!1},50))}).on("mouseup keydown keyup",function(e){(e.ctrlKey||e.metaKey)&&!e.altKey||setTimeout(function(){a=!1},50),clearTimeout(n),n=setTimeout(function(){o.updateButtonPaneStatus()},50)}).on("focus blur",function(e){o.$c.trigger("tbw"+e.type),"blur"===e.type&&p("."+t+"active-button",o.$btnPane).removeClass(t+"active-button "+t+"active"),o.o.autogrowOnEnter&&(o.autogrowOnEnterDontClose||("focus"===e.type?(o.autogrowOnEnterWasFocused=!0,o.autogrowEditorOnEnter()):o.o.autogrow||(o.$ed.css({height:o.$ed.css("min-height")}),o.$c.trigger("tbwresize"))))}).on("cut",function(){setTimeout(function(){o.semanticCode(!1,!0),o.$c.trigger("tbwchange")},0)}).on("paste",function(n){if(o.o.removeformatPasted){n.preventDefault(),h.getSelection&&h.getSelection().deleteFromDocument&&h.getSelection().deleteFromDocument();try{var t=h.clipboardData.getData("Text");try{o.doc.selection.createRange().pasteHTML(t)}catch(e){o.doc.getSelection().getRangeAt(0).insertNode(o.doc.createTextNode(t))}o.$c.trigger("tbwchange",n)}catch(e){o.execCmd("insertText",(n.originalEvent||n).clipboardData.getData("text/plain"))}}p.each(o.pasteHandlers,function(e,t){t(n)}),setTimeout(function(){o.semanticCode(!1,!0),o.$c.trigger("tbwpaste",n),o.$c.trigger("tbwchange")},0)}),o.$ta.on("keyup",function(){o.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){o.$c.trigger("tbwchange")},0)}),o.$box.on("keydown",function(e){if(27===e.which&&1===p("."+t+"modal-box",o.$box).length)return o.closeModal(),!1})},autogrowEditorOnEnter:function(){var e=this,t=(e.$ed.removeClass("autogrow-on-enter"),e.$ed[0].clientHeight),n=(e.$ed.height("auto"),e.$ed[0].scrollHeight);e.$ed.addClass("autogrow-on-enter"),t!==n&&(e.$ed.height(t),setTimeout(function(){e.$ed.css({height:n}),e.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var o=this,a=o.o.prefix,r=o.$btnPane=p("<div/>",{class:a+"button-pane"});p.each(o.o.btns,function(e,t){p.isArray(t)||(t=[t]);var n=p("<div/>",{class:a+"button-group "+(0<=t.indexOf("fullscreen")?a+"right":"")});p.each(t,function(e,t){try{o.isSupportedBtn(t)&&n.append(o.buildBtn(t))}catch(e){}}),0<n.html().trim().length&&r.append(n)}),o.$box.prepend(r)},buildBtn:function(e){var t,n,o=this,a=o.o.prefix,r=o.btnsDef[e],i=r.dropdown,s=null==r.hasIcon||r.hasIcon,l=o.lang[e]||e,s=p("<button/>",{type:"button",class:a+e+"-button "+(r.class||"")+(s?"":" "+a+"textual-button"),html:o.hasSvg&&s?'<svg><use xlink:href="'+o.svgPath+"#"+a+(r.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':o.hideButtonTexts?"":r.text||r.title||o.lang[e]||e,title:(r.title||r.text||l)+(r.key?" (Ctrl + "+r.key+")":""),tabindex:-1,mousedown:function(){return i&&!p("."+e+"-"+a+"dropdown",o.$box).is(":hidden")||p("body",o.doc).trigger("mousedown"),!((o.$btnPane.hasClass(a+"disable")||o.$box.hasClass(a+"disabled"))&&!p(this).hasClass(a+"active")&&!p(this).hasClass(a+"not-disable")||(o.execCmd((!i?r.fn:"dropdown")||e,r.param||e,r.forceCss),1))}});return i?(s.addClass(a+"open-dropdown"),(t={class:(l=a+"dropdown")+"-"+e+" "+l+" "+a+"fixed-top"})["data-"+l]=e,n=p("<div/>",t),p.each(i,function(e,t){o.btnsDef[t]&&o.isSupportedBtn(t)&&n.append(o.buildSubBtn(t))}),o.$box.append(n.hide())):r.key&&(o.keys[r.key]={fn:r.fn||e,param:r.param||e}),i||(o.tagToButton[(r.tag||e).toLowerCase()]=e),s},buildSubBtn:function(e){var t=this,n=t.o.prefix,o=t.btnsDef[e],a=null==o.hasIcon||o.hasIcon;return o.key&&(t.keys[o.key]={fn:o.fn||e,param:o.param||e}),t.tagToButton[(o.tag||e).toLowerCase()]=e,p("<button/>",{type:"button",class:n+e+"-dropdown-button"+(o.ico?" "+n+o.ico+"-button":""),html:t.hasSvg&&a?'<svg><use xlink:href="'+t.svgPath+"#"+n+(o.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(o.text||o.title||t.lang[e]||e):o.text||o.title||t.lang[e]||e,title:o.key?" (Ctrl + "+o.key+")":null,style:o.style||null,mousedown:function(){return p("body",t.doc).trigger("mousedown"),t.execCmd(o.fn||e,o.param||e,o.forceCss),!1}})},isSupportedBtn:function(e){try{return this.btnsDef[e].isSupported()}catch(e){}return!0},buildOverlay:function(){return this.$overlay=p("<div/>",{class:this.o.prefix+"overlay"}).appendTo(this.$box),this.$overlay},showOverlay:function(){p(h).trigger("scroll"),this.$overlay.fadeIn(200),this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50),this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var a=this,r=a.o.fixedFullWidth,i=a.$box;a.o.fixedBtnPane&&(a.isFixed=!1,p(h).on("scroll."+a.eventNamespace+" resize."+a.eventNamespace,function(){var e,t,n,o;i&&(a.syncCode(),e=p(h).scrollTop(),t=i.offset().top+1,o=(n=a.$btnPane).outerHeight()-2,0<e-t&&e-t-a.height<0?(a.isFixed||(a.isFixed=!0,n.css({position:"fixed",top:0,left:r?"0":"auto",zIndex:7}),p([a.$ta,a.$ed]).css({marginTop:n.height()})),n.css({width:r?"100%":i.width()-1+"px"}),p("."+a.o.prefix+"fixed-top",i).css({position:r?"fixed":"absolute",top:r?o:e-t+o+"px",zIndex:15})):a.isFixed&&(a.isFixed=!1,n.removeAttr("style"),p([a.$ta,a.$ed]).css({marginTop:0}),p("."+a.o.prefix+"fixed-top",i).css({position:"absolute",top:o})))}))},setDisabled:function(e){var t=this,n=t.o.prefix;(t.disabled=e)?t.$ta.attr("disabled",!0):t.$ta.removeAttr("disabled"),t.$box.toggleClass(n+"disabled",e),t.$ed.attr("contenteditable",!e)},destroy:function(){var e=this,t=e.o.prefix;e.isTextarea?e.$box.after(e.$ta.css({height:""}).val(e.html()).removeClass(t+"textarea").show()):e.$box.after(e.$ed.css({height:""}).removeClass(t+"editor").removeAttr("contenteditable").removeAttr("dir").html(e.html()).show()),e.$ed.off("dblclick","img"),e.destroyPlugins(),e.$box.remove(),e.$c.removeData("trumbowyg"),p("body").removeClass(t+"body-fullscreen"),e.$c.trigger("tbwclose"),p(h).off("scroll."+e.eventNamespace+" resize."+e.eventNamespace)},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var e=this,t=e.o.prefix;e.o.autogrowOnEnter&&(e.autogrowOnEnterDontClose=!e.$box.hasClass(t+"editor-hidden")),e.semanticCode(!1,!0),setTimeout(function(){e.doc.activeElement.blur(),e.$box.toggleClass(t+"editor-hidden "+t+"editor-visible"),e.$btnPane.toggleClass(t+"disable"),p("."+t+"viewHTML-button",e.$btnPane).toggleClass(t+"active"),e.$box.hasClass(t+"editor-visible")?e.$ta.attr("tabindex",-1):e.$ta.removeAttr("tabindex"),e.o.autogrowOnEnter&&!e.autogrowOnEnterDontClose&&e.autogrowEditorOnEnter()},0)},dropdown:function(e){var t=this,n=t.doc,o=t.o.prefix,a=p("[data-"+o+"dropdown="+e+"]",t.$box),e=p("."+o+e+"-button",t.$btnPane),r=a.is(":hidden");p("body",n).trigger("mousedown"),r&&(r=e.offset().left,e.addClass(o+"active"),a.css({position:"absolute",top:e.offset().top-t.$btnPane.offset().top+e.outerHeight(),left:t.o.fixedFullWidth&&t.isFixed?r+"px":r-t.$btnPane.offset().left+"px"}).show(),p(h).trigger("scroll"),p("body",n).on("mousedown."+t.eventNamespace,function(e){a.is(e.target)||(p("."+o+"dropdown",t.$box).hide(),p("."+o+"active",t.$btnPane).removeClass(o+"active"),p("body",n).off("mousedown."+t.eventNamespace))}))},html:function(e){var t=this;return null!=e?(t.$ta.val(e),t.syncCode(!0),t.$c.trigger("tbwchange"),t):t.$ta.val()},syncTextarea:function(){var e=this;e.$ta.val(0<e.$ed.text().trim().length||0<e.$ed.find(e.o.tagsToKeep.join(",")).length?e.$ed.html():"")},syncCode:function(e){var t=this;!e&&t.$ed.is(":visible")?t.syncTextarea():(e=p("<div>").html(t.$ta.val()),e=p("<div>").append(e),p(t.o.tagsToRemove.join(","),e).remove(),t.$ed.html(e.contents().html())),t.o.autogrow&&(t.height=t.$ed.height(),t.height!==t.$ta.css("height")&&(t.$ta.css({height:t.height}),t.$c.trigger("tbwresize"))),t.o.autogrowOnEnter&&(t.$ed.height("auto"),(e=t.autogrowOnEnterWasFocused?t.$ed[0].scrollHeight:t.$ed.css("min-height"))!==t.$ta.css("height")&&(t.$ed.css({height:e}),t.$c.trigger("tbwresize")))},semanticCode:function(e,t,n){var o,a,r,i=this;i.saveRange(),i.syncCode(e),i.o.semantic&&(i.semanticTag("b"),i.semanticTag("i"),i.semanticTag("s"),i.semanticTag("strike"),t&&(o=i.o.inlineElementsSelector,a=":not("+o+")",i.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>"),(r=function(e){var t;0!==e.length&&(t=(e=e.nextUntil(a).addBack().wrapAll("<p/>").parent()).nextAll(o).first(),e.next("br").remove(),r(t))})(i.$ed.children(o).first()),i.semanticTag("div",!0),i.$ed.find("p").filter(function(){return(!i.range||this!==i.range.startContainer)&&0===p(this).text().trim().length&&0===p(this).children().not("br,span").length}).contents().unwrap(),p("[data-tbw]",i.$ed).contents().unwrap(),i.$ed.find("p:empty").remove()),n||i.restoreRange(),i.syncTextarea())},semanticTag:function(e,t){var n;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(e))n=this.o.semantic[e];else{if(!0!==this.o.semantic||!this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(e))return;n=this.DEFAULT_SEMANTIC_MAP[e]}p(e,this.$ed).each(function(){var e=p(this);return 0!==e.contents().length&&(e.wrap("<"+n+"/>"),t&&p.each(e.prop("attributes"),function(){e.parent().attr(this.name,this.value)}),void e.contents().unwrap())})},createLink:function(){for(var e,t,n,o,a=this,r=a.doc.getSelection(),i=r.focusNode,s=(new XMLSerializer).serializeToString(r.getRangeAt(0).cloneContents());["A","DIV"].indexOf(i.nodeName)<0;)i=i.parentNode;i&&"A"===i.nodeName&&(s=(o=p(i)).text(),n=o.attr("href"),a.o.minimalLinks||(e=o.attr("title"),t=o.attr("target")),(o=a.doc.createRange()).selectNode(i),r.removeAllRanges(),r.addRange(o)),a.saveRange();r={url:{label:"URL",required:!0,value:n},text:{label:a.lang.text,value:s}};a.o.minimalLinks||Object.assign(r,{title:{label:a.lang.title,value:e},target:{label:a.lang.target,value:t}}),a.openModalInsert(a.lang.createLink,r,function(e){var t=a.prependUrlPrefix(e.url);if(!t.length)return!1;t=p(['<a href="',t,'">',e.text||e.url,"</a>"].join(""));return a.o.minimalLinks||(0<e.title.length&&t.attr("title",e.title),0<e.target.length&&t.attr("target",e.target)),a.range.deleteContents(),a.range.insertNode(t[0]),a.syncCode(),a.$c.trigger("tbwchange"),!0})},prependUrlPrefix:function(e){if(!this.urlPrefix)return e;if(/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(e))return e;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?"mailto:"+e:this.urlPrefix+e},unlink:function(){var e,t=this.doc.getSelection(),n=t.focusNode;if(t.isCollapsed){for(;["A","DIV"].indexOf(n.nodeName)<0;)n=n.parentNode;n&&"A"===n.nodeName&&((e=this.doc.createRange()).selectNode(n),t.removeAllRanges(),t.addRange(e))}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var n=this,e=(n.saveRange(),{url:{label:"URL",required:!0},alt:{label:n.lang.description,value:n.getRangeText()}});n.o.imageWidthModalEdit&&(e.width={}),n.openModalInsert(n.lang.insertImage,e,function(e){n.execCmd("insertImage",e.url,!1,!0);var t=p('img[src="'+e.url+'"]:not([alt])',n.$box);return t.attr("alt",e.alt),n.o.imageWidthModalEdit&&t.attr({width:e.width}),n.syncCode(),n.$c.trigger("tbwchange"),!0})},fullscreen:function(){var e=this.o.prefix,t=e+"fullscreen";this.$box.toggleClass(t),t=this.$box.hasClass(t),p("body").toggleClass(e+"body-fullscreen",t),p(h).trigger("scroll"),this.$c.trigger("tbw"+(t?"open":"close")+"fullscreen")},execCmd:function(t,n,e,o){var a=this;o=!!o||"","dropdown"!==t&&a.$ed.focus();try{a.doc.execCommand("styleWithCSS",!1,e||!1)}catch(e){}try{a[t+o](n)}catch(e){try{t(n)}catch(e){"insertHorizontalRule"===t?n=void 0:"formatBlock"===t&&a.isIE&&(n="<"+n+">"),a.doc.execCommand(t,!1,n),a.syncCode(),a.semanticCode(!1,!0)}"dropdown"!==t&&(a.updateButtonPaneStatus(),a.$c.trigger("tbwchange"))}},openModal:function(e,t){var n=this,o=n.o.prefix;if(0<p("."+o+"modal-box",n.$box).length)return!1;n.o.autogrowOnEnter&&(n.autogrowOnEnterDontClose=!0),n.saveRange(),n.showOverlay(),n.$btnPane.addClass(o+"disable");var a=p("<div/>",{class:o+"modal "+o+"fixed-top"}).css({top:n.$box.offset().top+n.$btnPane.height(),zIndex:99999}).appendTo(p(n.doc.body)),t=(n.$overlay.one("click",function(){return a.trigger(c),!1}),p("<form/>",{action:"",html:t}).on("submit",function(){return a.trigger(d),!1}).on("reset",function(){return a.trigger(c),!1}).on("submit reset",function(){n.o.autogrowOnEnter&&(n.autogrowOnEnterDontClose=!1)})),t=p("<div/>",{class:o+"modal-box",html:t}).css({top:"-"+n.$btnPane.outerHeight()+"px",opacity:0}).appendTo(a).animate({top:0,opacity:1},100);return p("<span/>",{text:e,class:o+"modal-title"}).prependTo(t),a.height(t.outerHeight()+10),p("input:first",t).focus(),n.buildModalBtn("submit",t),n.buildModalBtn("reset",t),p(h).trigger("scroll"),a},buildModalBtn:function(e,t){var n=this.o.prefix;return p("<button/>",{class:n+"modal-button "+n+"modal-"+e,type:e,text:this.lang[e]||e}).appendTo(p("form",t))},closeModal:function(){var e=this,t=e.o.prefix,n=(e.$btnPane.removeClass(t+"disable"),e.$overlay.off(),p("."+t+"modal-box",p(f.body)));n.animate({top:"-"+n.height()},100,function(){n.parent().remove(),e.hideOverlay()}),e.restoreRange()},openModalInsert:function(e,t,n){var s=this,r=s.o.prefix,i=s.lang,l="";return p.each(t,function(e,t){var n=t.label||e,e=t.name||e,o=t.attributes||{},a=Object.keys(o).map(function(e){return e+'="'+o[e]+'"'}).join(" ");l+='<label><input type="'+(t.type||"text")+'" name="'+e+'"'+("checkbox"===t.type&&t.value?' checked="checked"':' value="'+(t.value||"").replace(/"/g,"&quot;"))+'"'+a+'><span class="'+r+'input-infos"><span>'+(i[n]||n)+"</span></span></label>"}),s.openModal(e,l).on(d,function(){var a=p("form",p(this)),r=!0,i={};p.each(t,function(e,t){var n=t.name||e,o=p('input[name="'+n+'"]',a);switch(o.attr("type").toLowerCase()){case"checkbox":i[n]=o.is(":checked");break;case"radio":i[n]=o.filter(":checked").val();break;default:i[n]=p.trim(o.val())}t.required&&""===i[n]?(r=!1,s.addErrorOnModalField(o,s.lang.required)):t.pattern&&!t.pattern.test(i[n])&&(r=!1,s.addErrorOnModalField(o,t.patternError))}),r&&(s.restoreRange(),n(i,t)&&(s.syncCode(),s.$c.trigger("tbwchange"),s.closeModal(),p(this).off(d)))}).one(c,function(){p(this).off(d),s.closeModal()})},addErrorOnModalField:function(e,t){var n=this.o.prefix,o=e.parent();e.on("change keyup",function(){o.removeClass(n+"input-error")}),o.addClass(n+"input-error").find("input+span").append(p("<span/>",{class:n+"msg-error",text:t}))},getDefaultImgDblClickHandler:function(){var o=this;return function(){var t=p(this),e=t.attr("src"),n="(Base64)",e={url:{label:"URL",value:e=0===e.indexOf("data:image")?n:e,required:!0},alt:{label:o.lang.description,value:t.attr("alt")}};return o.o.imageWidthModalEdit&&(e.width={value:t.attr("width")?t.attr("width"):""}),o.openModalInsert(o.lang.insertImage,e,function(e){return e.url!==n&&t.attr({src:e.url}),t.attr({alt:e.alt}),o.o.imageWidthModalEdit&&(0<parseInt(e.width)?t.attr({width:e.width}):t.removeAttr("width")),!0}),!1}},saveRange:function(){var e,t=this,n=t.doc.getSelection();t.range=null,n.rangeCount&&(n=t.range=n.getRangeAt(0),(e=t.doc.createRange()).selectNodeContents(t.$ed[0]),e.setEnd(n.startContainer,n.startOffset),t.metaRange={start:t=(e+"").length,end:t+(n+"").length})},restoreRange:function(){var e=this,t=e.metaRange,n=e.range,o=e.doc.getSelection();if(n){if(t&&t.start!==t.end)for(var a,r=0,i=[e.$ed[0]],s=!1,c=!1,l=e.doc.createRange();!c&&(a=i.pop());)if(3===a.nodeType){var d=r+a.length;!s&&t.start>=r&&t.start<=d&&(l.setStart(a,t.start-r),s=!0),s&&t.end>=r&&t.end<=d&&(l.setEnd(a,t.end-r),c=!0),r=d}else for(var u=a.childNodes,g=u.length;0<g;)i.push(u[--g]);o.removeAllRanges(),o.addRange(l||n)}},getRangeText:function(){return this.range+""},updateButtonPaneStatus:function(){var a=this,r=a.o.prefix,e=a.getTagsRecursive(a.doc.getSelection().focusNode),i=r+"active-button "+r+"active";p("."+r+"active-button",a.$btnPane).removeClass(i),p.each(e,function(e,t){t=a.tagToButton[t.toLowerCase()];if(0<(n=p("."+r+t+"-button",a.$btnPane)).length)n.addClass(i);else try{var n,o=(n=p("."+r+"dropdown ."+r+t+"-dropdown-button",a.$box)).parent().data("dropdown");p("."+r+o+"-button",a.$box).addClass(i)}catch(e){}})},getTagsRecursive:function(n,o){var a=this;if(o=o||(n&&n.tagName?[n.tagName]:[]),!n||!n.parentNode)return o;var e=(n=n.parentNode).tagName;return"DIV"===e?o:("P"===e&&""!==n.style.textAlign&&o.push(n.style.textAlign),p.each(a.tagHandlers,function(e,t){o=o.concat(t(n,a))}),o.push(e),a.getTagsRecursive(n,o).filter(function(e){return null!=e}))},initPlugins:function(){var n=this;n.loadedPlugins=[],p.each(p.trumbowyg.plugins,function(e,t){t.shouldInit&&!t.shouldInit(n)||(t.init(n),t.tagHandler&&n.tagHandlers.push(t.tagHandler),n.loadedPlugins.push(t))})},destroyPlugins:function(){p.each(this.loadedPlugins,function(e,t){t.destroy&&t.destroy()})}}}(navigator,window,document,jQuery);