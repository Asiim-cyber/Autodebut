!function(c){"use strict";function o(e){this.init(e)}(o.prototype={instances:[],_coldInit:0,get:function(e,t,i){if("string"==typeof e)return e=e.toLowerCase(),!i&&void 0!==i||(this.trigger("get"),this.trigger("get:"+e)),this._props[e]},set:function(e,t,i,n){if(!e)return this;if("object"==typeof e){var l,s=Object.create(null);for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&(s[l]=this.set(l,e[l],null,n));return this}if("string"!=typeof e)return this;e=e.toLowerCase();var o={value:t};return(n=void 0===n?!0:n)&&(this.trigger("set",o),this.trigger("set:"+e,o),this.trigger("beforeSet:"+e,o)),this._props[e]=t,n&&this.trigger("afterSet:"+e,o),this},getInstances:function(e){if(!arguments.length)return this.instances;"object"!=typeof e&&(e=Object.create(null));for(var t=[],i=-1<c.inArray(typeof e.name,["string","number"])?e.name:null,n=0;n<this.instances.length;n++)null!==i&&this.instances[n].get("name",void 0,!1)!=i||t.push(this.instances[n]);return t},removeInstances:function(e){if("object"!=typeof e)return this;for(var t="string"!=typeof e.name?null:e.name,i=[],n=0;n<this.instances.length;n++)this.instances[n].get("name",void 0,!1)!=t?i.push(this.instances[n]):c(this.instances[n].get("dbox",void 0,!1)).detach();return this.instances=i,this},_targetEvents:{click:{name:"click",event:"click"},keydown:{name:"keydown",event:"keydown",dbox_input:!0},keyup:{name:"keyup",event:"keyup",dbox_input:!0},hover:{name:"hover",event:"hover"},focus:{name:"focus",event:"focus"},focusout:{name:"focusout",event:"focusout"},change:{name:"change",event:"change"}},_eventCheckInputEmpty:function(e){this.fx.isTextInput(e.target)&&!e.target.value.trim()&&this.trigger("input:empty",e)},_eventDefaultInputEmpty:function(){this.deselectAll()},_eventSetList:function(){this.set("list",arguments[1].value,null,!1),this.reInitList()},_eventWindowResize:function(){for(var e=0;e<this.instances.length;e++)this.instances[e].isActive()&&(this.instances[e]._calcListContainerHeight(),this.instances[e].calcPosition())},_eventDefaultKeyUp:function(e){var n=this,t=n.get("target",null,!1),i=n.get("dbox_input",null,!1),l=e.keyCode,s=(n.get("list",null,!1),n.get("dbox",null,!1),e.currentTarget),o=[37,38,39,40,9,13,18,17,16,20,27];n._isDBoxInput(e.target)?n.fx.isTextInput(t)&&(t.value=i.value):s==t&&-1==c.inArray(e.keyCode,o)&&(i.value=t.value),clearTimeout(n._timers.autoComplete),n._timers.autoComplete=setTimeout(function(){var e,t,i;if(n.get("autoComplete",null,!1)&&c.inArray(l,o)<0&&(e=(e=s.value.toLowerCase().split(/[;,]/gi))[e.length-1],n.unhoverAllOpt(),n.applyAutoComplete(e),n._isMobileState()||n.calcPosition()),n.get("multiple",null,!1)&&8==l){for(e=n.fx.trim(s.value," ;,").split(/[,;]/gi),i=n.getSelectedKeys(),t=0;t<e.length;t++)e[t]=e[t].trim();n._selectByLabel(e,!0),n.applySelectedToList(n._getItemsByID(i.concat(n.getSelectedKeys())))}},n.get("autoCompleteTimeoutDelay",null,!1))},_eventDefaultKeyDownMultipleFalse:function(e){var t=this,i=this.get("selectedCache",null,!1),i=i[Object.keys(i)[0]],n=t.get("target",null,!1);if(!(t.get("multiple",null,!1)||-1<c.inArray(e.keyCode,[37,39,9,18,17,16,20,27])))if(13==e.keyCode)t.isActive()?t.close():(t.open(),t._eventFocus.call(n,t,e));else if(-1<c.inArray(e.keyCode,[38,39,40])&&t.isActive()){if(i)if(38==e.keyCode)i=t.selectPrevVisibleItem(i);else{if(40!=e.keyCode)return;i=t.selectNextVisibleItem(i)}else i=t.selectPrevVisibleItem(t.getFirstVisibleItem());t.calcScrollBarPosition(),e.listItem=i,t.trigger("select",e)}},_eventDefaultKeyDownMultipleTrue:function(e){var t,i=this,n=(i.get("list",null,!1),i.getHoveredItems()[0]);if(i.get("multiple")){if(!(-1<c.inArray(e.keyCode,[37,39,9,18,17,16,20,27]))){if(13==e.keyCode)return n?(t=i.getSelectedKeys(),n.selected?i._deselectByID(n.id):i._selectByID(n.id),t=t.concat(i.getSelectedKeys()),i.applySelectedToInput(),i.applySelectedToList(i._getItemsByID(t)),e.listItem=n,void i.trigger("select",e)):void 0;38!=e.keyCode&&40!=e.keyCode||(n?(38==e.keyCode&&i.hoverPrevVisibleItem(n),40==e.keyCode&&i.hoverNextVisibleItem(n)):i.hoverItem(i.getFirstVisibleItem()))}i.calcScrollBarPosition()}},_eventFocus:function(e,t){var i,n,l,s=this,o=s.getSelectedKeys(),a=s.get("list",null,!1),r=(s.get("dbox",null,!1),t.currentTarget||(this instanceof Element?this:null));if(s.open(),s.fx.isTextInput(r))if(l=(l=r.getAttribute("data-msdb-value"))&&l.trim()){for(l=l.split(/[;,]/gi),i=0;i<l.length;i++)l[i]=l[i].trim();s._selectByValue(l,!0)}else{for(n=s.fx.trim(r.value,",; ").split(/[;,]/gi),i=0;i<n.length;i++)n[i]=n[i].trim();s._selectByLabel(n,!0)}s.unhideAllOpt(),Object.keys(a).forEach(function(e){e=a[e];void 0!==r.type&&-1<c.inArray(r.type.toLowerCase(),["submit","button"])||-1<c.inArray(r.tagName.toLowerCase(),["submit","body","select"])||s.unhoverItem(e)}),o=o.concat(s.getSelectedKeys()),s.get("freeWrite")||s.applySelectedToInput(),s.applySelectedToList(s._getItemsByID(o)),s.calcScrollBarPosition(),s._calcListContainerHeight()},_onFocusOut:function(){this.get("multiple",null,!1)&&this.applySelectedToInput()},_initEvents:function(e){c("body").get(0);var t,i=this,n={};for(t in this.events=Object.create(null),e)e.hasOwnProperty(t)&&"function"==typeof e[t]&&(n[t.replace(/^on/,"")]=e[t]);for(t in e.events)e.events.hasOwnProperty(t)&&"function"==typeof e.events[t]&&(n[t]=e.events[t]);for(t in n)n.hasOwnProperty(t)&&this.on(t,n[t]);this.on("keyup",function(e,t){i._eventCheckInputEmpty(t)}),this.on("change",function(e,t){i._eventCheckInputEmpty(t)}),this.on("input:empty",i._eventDefaultInputEmpty),this.on("focus",i._eventFocus.bind(i)),this.on("click",i._eventFocus.bind(i)),this.on("focusout",function(e,t){t.relatedTarget?i._isDBoxInput(t.relatedTarget)||i._isDBoxElement(t.relatedTarget)||i._isTargetElement(t.relatedTarget)||i.close():i._timers.focusoutInputs=setTimeout(function(){i.close()},i.get("focusOutInputsTimeoutDelay",null,!1))}),this.on("focusout",this._onFocusOut),c(this.get("dbox_input")).bind("focus",function(){clearTimeout(i._timers.focusoutInputs)}),this.on("afterSet:list",this._eventSetList),i._isColdInit()&&window.addEventListener("resize",i._eventWindowResize.bind(i),!1)},_deactivateInstances:function(e){for(var t=0;t<this.instances.length;t++)this.instances[t]._isDBoxElement(e.target)||this.instances[t]._isTargetElement(e.target)||this.instances[t].isActive()&&this.instances[t].close()},_initTarget:function(){var e=this.get("target");e&&"object"==typeof e&&("string"==typeof e?(e=c(e).get(0),this.set("target",e,null,!1)):e instanceof Element?this.set("target",e,null,!1):e instanceof c&&this.set(e.get(0),null,!1))},trigger:function(e,t){if("string"!=typeof e)return this;if(e=e.toLowerCase(),"object"==typeof this.events[e]&&Array.isArray(this.events[e])){(!t||t instanceof(window.CustomEvent||Function)==0&&t instanceof(window.Event||Function)==0&&t instanceof c.Event==0||t instanceof c.Event==0)&&(t=c.Event(e,t));for(var i=this.events[e],n=0;n<i.length;n++)"function"==typeof i[n]&&i[n].call(this,this,t)}return this},on:function(t,e){var i=this,n=this.get("target",null,!1),l=this.get("dbox_input",null,!1);return"string"!=typeof t||"function"!=typeof e||(t=t.toLowerCase(),"object"==typeof this.events[t]&&Array.isArray(this.events[t])||(this.events[t]=[],this._targetEvents.hasOwnProperty(t)&&(c(n).bind(this._targetEvents[t].event,function(e){i.trigger(t,e)},null),this._targetEvents[t].dbox_input&&c(l).bind(this._targetEvents[t].event,function(e){i.trigger(t,e)},null))),this.events[t].push(e)),this},detectLanguage:function(){return((navigator.languages||[])[0]||navigator.language||navigator.systemLanguage||navigator.userLanguage||navigator.browserLanguage||"en-US").split(/[-_]/gi)[0]},_lastLang:"",_texts:{".m-select-d-box-fade__outside-click-label-text":{ru:"Нажмите чтобы закрыть",en:"Tap to close"},".m-select-d-box__search-input":{ru:"Поиск",en:"Search"}},getText:function(e,t){return t=t||(this.get("language")||this.detectLanguage()),(this._texts[e]||{})[t]||""},setText:function(e,t,i){var n=!0,l=this instanceof o?(n=!1,Object.getPrototypeOf(this)):this;return l._texts[t]||(l._texts[t]={}),i=i||(!n&&this.get("language")||this.detectLanguage()),l._texts[t][i]=e,this},_globalElems:{fade:void 0},_globalStyles:((e={".m-select-d-box":{position:"absolute",display:"block",width:"250px",padding:"8px",height:"auto","box-shadow":"0 10px 20px -5px rgba(0, 0, 0, 0.4)","background-color":"#FFF","border-radius":"3px",border:"1px solid #e6e6e6"},".m-select-d-box:after":{content:"''",position:"absolute","border-left":"10px solid transparent","border-right":"9px solid transparent","border-bottom":"10px solid white",top:"-10px",left:"50%","margin-left":"-10px"},".m-select-d-box:before":{content:"''",position:"absolute","border-left":"11px solid transparent","border-right":"11px solid transparent","border-bottom":"11px solid #e6e6e6",top:"-11px",left:"50%","margin-left":"-11px"},".m-select-d-box_bottom:after":{content:"''",position:"absolute","border-left":"10px solid transparent","border-right":"9px solid transparent","border-bottom":"none","border-top":"10px solid white",top:"auto",bottom:"-10px",left:"50%","margin-left":"-10px"},".m-select-d-box_bottom:before":{border:"none"},".m-select-d-box__list-container":{position:"relative",margin:"0px",padding:"0px","max-height":"200px","overflow-x":"hidden"},".m-select-d-box__list-item":{position:"relative",padding:"10px","background-color":"none",color:"black",display:"block","line-height":"100%",cursor:"pointer","font-size":"14px"},".m-select-d-box__list-item:hover, .m-select-d-box__list-item_hover":{"background-color":"#e6e6e6"},".m-select-d-box__list-item_selected":{"background-color":"#C40056",color:"white"},".m-select-d-box__list-item_selected:hover, .m-select-d-box__list-item_selected.m-select-d-box__list-item_hover":{"background-color":"#DB2277"},".m-select-d-box__list-item_selected:before":{content:"':: '"},".m-select-d-box__list-item:active, .m-select-d-box__list-item_selected:active":{"background-color":"#b80000",color:"white"},".m-select-d-box__list-item_hidden":{display:"none"},".m-select-d-box__search-input":{border:"1px solid #a2a2a2",width:"100%","line-height":"100%","font-size":"14px","border-width":"0 0 2px 0",padding:"8px","box-sizing":"border-box"},".m-select-d-box__search-input-container":{"margin-bottom":"12px",display:"none"},".m-select-d-box__search-input-container_active":{display:"block"},".m-select-d-box-fade":{display:"none",width:0,height:0,left:0,top:0},".m-select-d-box-fade__outside-click-label":{position:"absolute",width:"100%",bottom:0,padding:"10px",background:"black",color:"white","text-align":"center","font-size":"1em","box-sizing":"border-box"},".m-select-d-box-fade__outside-click-label-text":{},".m-select-d-box-fade__outside-click-label-icon":{position:"relative","border-radius":"50%","margin-right":"5px",border:"2px solid white",display:"inline-block",height:"16px",width:"16px","vertical-align":"middle"},".m-select-d-box-fade__outside-click-label-icon:after":{content:"''",position:"absolute",top:"50%",left:"50%",height:"80%",width:"2px",transform:"rotate(45deg)","margin-left":"-1px","margin-top":"-40%",background:"white"},".m-select-d-box-fade__outside-click-label-icon:before":{content:"''",position:"absolute",top:"50%",left:"50%",height:"80%",width:"2px",transform:"rotate(-45deg)","margin-left":"-1px","margin-top":"-40%",background:"white"},"@media screen and (max-width: 640px)":{".m-select-d-box":{position:"fixed",width:"80% !important",padding:"0 !important",left:"10% !important",top:"5% !important","max-height":"90%","box-shadow":"none","border-radius":"0px","box-sizing":"border-box"},".m-select-d-box:after":{content:"none"},".m-select-d-box__list-container":{"max-height":"none"},".m-select-d-box__list-item":{padding:"1em","font-size":"1em"},".m-select-d-box__search-input-container":{"margin-bottom":"12px",display:"block"},".m-select-d-box__search-input":{"line-height":"1em","font-size":"1em",padding:"1em"},".m-select-d-box-fade":{width:"100%",height:"100%",position:"fixed",left:0,top:0,"background-color":"rgba(0, 0, 0, 0.33)",display:"block"}},"@media screen and (max-width: 740px)":{"@media screen and (min-resolution: 2dppx)":{}},".m-select-d-box_hidden":{display:"none"}})["@media screen and (max-width: 740px)"]["@media screen and (min-resolution: 2dppx)"]=e["@media screen and (max-width: 640px)"],e),_initStyles:function(){return c("#m-select-d-box-style").length||this._buildStyles(),this},_buildStyles:function(){var e=c("body"),l=function(e){var t,i,n="";for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))if(t.match(/^@media/))n+=t+" {"+l(e[t])+"} ";else{for(i in n+=t+" {",e[t])Object.prototype.hasOwnProperty.call(e[t],i)&&(n+=i+":"+e[t][i]+";");n+="} "}return n},t=l(this._globalStyles),i=c("#m-select-d-box-style");return i.length||((i=c("<style />")).attr("id","m-select-d-box-style"),e.append(i)),i.html(t),this},_initProps:function(e){for(var t,i={},n=[{key:"name",type:"string"},{key:"list",type:"array"},{key:"autoApply",type:"any",into:"boolean"},{key:"autoPosition",type:"any",into:"boolean"},{key:"autoComplete",type:"any",into:"boolean"},{key:"target",type:"object"},{key:"multiple",type:"any",into:"boolean"},{key:"zIndex",type:"numeric",into:"integer"},{key:"width",type:"any"},{key:"embeddedInput",type:"any",into:"boolean"},{key:"optionFilters",type:"array"},{key:"closeButton",type:"boolean"},{key:"language",type:"string",default:this.detectLanguage()},{key:"freeWrite",type:"any",into:"boolean"}],l=0;l<n.length;l++)n[l].key=n[l].key.toLowerCase(),"default"in n[l]&&(i[n[l].key]=n[l].default);if(this.set(i),"object"==typeof e){for(t in e)if(e.hasOwnProperty(t)){for(var s=t.toLowerCase(),o=null,a=0;a<n.length;a++)if(n[a].key.toLowerCase()==s){o=n[a];break}if(o){if("any"!=o.type)if("array"==o.type){if(!Array.isArray(e[t]))throw new Error("Argument data type mismatch (key: '"+t+"')")}else if("numeric"==o.type){if(isNaN(e[t]))throw new Error("Argument data type mismatch (key: '"+t+"')")}else if(o.type!=typeof e[t])throw new Error("Argument data type mismatch (key: '"+t+"')");o.hasOwnProperty("into")&&("boolean"==o.into?e[t]=Boolean(e[t]):"integer"==o.into?e[t]=parseInt(e[t]):"float"==o.into&&(e[t]=parseFloat(e[t]))),"width"==t&&(e[t]=void 0===e.width?"min":-1<c.inArray(e.width,["min","auto"])?e.width:parseInt(e.width)),this.set(s,e[t])}}this.set({firstItem:void 0,lastItem:void 0,hoveredCache:Object.create(null),hiddenCache:Object.create(null),selectedCache:Object.create(null),valuesCache:Object.create(null),labelsCache:Object.create(null)},null,!1)}},_initElements:function(){var e=c("body").get(0),t=(this._globalElems.fade||(this._globalElems.fade=c('<div class="m-select-d-box-fade m-select-d-box_hidden"><div class="m-select-d-box-fade__outside-click-label"><div class="m-select-d-box-fade__outside-click-label-icon"></div><span class="m-select-d-box-fade__outside-click-label-text">'+this.getText(".m-select-d-box-fade__outside-click-label-text")+"<span></div></div>").get(0),e.appendChild(this._globalElems.fade)),document.createElement("div")),i=(this.set("dbox",t),t.className="m-select-d-box m-select-d-box_hidden",c('<div class="m-select-d-box__search-input-container"><input class="m-select-d-box__search-input" placeholder="tapez ici...'+this.getText(".m-select-d-box__search-input")+'" type="text"></div>').get(0)),i=(this.set("dbox_input",c("input",i).get(0)),t.appendChild(i),Boolean(this.get("embeddedInput"))&&(i.className+=" m-select-d-box__search-input-container_active"),this.set("dbox",t),this.get("zIndex")&&(t.style.zIndex=this.get("zIndex")),t.appendChild(c('<ul class="m-select-d-box__list-container"></ul>').get(0)),this.get("width"));"auto"==i?t.style.width=this.get("target").clientWidth+"px":"min"==i||(t.style.width=i+"px"),e.appendChild(t)},_initList:function(){var e=this.get("list",null,!1);if(!c.isArray(e))return this.set("list",[],null,!1),!1;var t,i,n,l=Object.create(null),s=Object.create(null),o=this,a=this.get("dbox",null,!1),r=c(".m-select-d-box__list-container",a).get(0);for(this._onItemClick||(this._onItemClick=function(e){clearTimeout(o._timers.focusoutInputs);var t=this.getAttribute("data-msdbid"),i=o.get("list",null,!1),n=o.getSelectedKeys().concat(t);o.get("multiple",null,!1)?i[t].selected?o._deselectByID(t):o._selectByID(t,!1):o._selectByID(t,!0),o.applySelectedToInput(),o.applySelectedToList(o._getItemsByID(n)),e.listItem=i[t],o.trigger("select",e),o.calcPosition(),o.get("multiple",null,!1)||o.close()}),this._onMouseLeave||(this._onMouseLeave=function(){var e=c(this);e.hasClass("m-select-d-box__list-item_hover")&&e.removeClass("m-select-d-box__list-item_hover")}),r.innerHTML="",t=0;t<e.length;t++)if([e[t]]+""){if(-1<c.inArray(typeof e[t],["number","string"]))e[t]={value:e[t]+"",label:e[t]+"",selected:!1};else{if("object"!=typeof e[t]||!this.fx.hop(e[t],"value")||!this.fx.hop(e[t],"label"))continue;void 0===e[t].selected?e[t].selected=!1:e[t].selected=Boolean(e[t].selected),e[t].value+="",e[t].label+=""}e[t].id=t,s[e[t].value]=e[t],l[e[t].label]=e[t],n&&(n.next=e[t],e[t].prev=n),n=e[t],(i=e[t]).isHovered=!1,i.elem=document.createElement("li"),i.elem.className="m-select-d-box__list-item",i.elem.setAttribute("data-msdbid",t+""),i.$elem=c(i.elem),c(i.elem).bind("click",this._onItemClick,null),c(i.elem).bind("mouseleave",this._onMouseLeave,null),i.elem.innerHTML=i.label,r.appendChild(i.elem)}this.set("firstItem",e[0],null,!1),this.set("lastItem",e[e.length-1],null,!1),this.set("labelsCache",l,null,!1),this.set("valuesCache",s,null,!1)},init:function(e){this._props=Object.create(null);var i=this,t=c("body").get(0),e=(this.events=Object.create(null),this._initProps(e),this._initTarget(),this._initElements(),this._initEvents(e),this._initList(),this._initStyles(),this.set("autoCompleteTimeoutDelay",500,null,!1),this.set("focusOutInputsTimeoutDelay",250,null,!1),this._timers=Object.create(null),this._timers.autoComplete=null,this._timers.focusedInputs=null,this._timers.focusoutInputs=null,this.get("target",null,!1)),n=this.get("dbox",null,!1);i.get("name",null,!1)&&(e.setAttribute("data-msdb-name",i.get("name",null,!1)),n.setAttribute("data-msdb-name",i.get("name",null,!1))),i.on("keydown",function(e,t){i._eventDefaultKeyDownMultipleFalse(t),i._eventDefaultKeyDownMultipleTrue(t)}),i.on("keyup",function(e,t){i._eventDefaultKeyUp(t)}),i.get("optionFilters",null,!1)||i.set("optionFilters",[i.defaultOptionFilters.default],null,!1),i._isColdInit()&&c(t).bind("click",function(e){i._deactivateInstances(e)},null),this.instances.push(this),i.trigger("init")},_applyLang:function(e){this._lastLang!=e&&(Object.getPrototypeOf(this)._lastLang=e,c(this._globalElems.fade).find(".m-select-d-box-fade__outside-click-label-text").html(this.getText(".m-select-d-box-fade__outside-click-label-text")))},calcPosition:function(){var e=c("body").get(0),t=this.get("target",null,!1),i=this.get("dbox",null,!1),n=c(i),l=c(t).offset(),s=t.clientWidth,t=t.clientHeight,o=i.clientWidth,s=(n.removeClass("m-select-d-box_bottom"),i.style.left=l.left+s/2-(o+2*this._globalStyles[".m-select-d-box"].padding.replace(/[px]/gi,""))/2+"px",window.scrollY||e.scrollTop);i.clientHeight+l.top+t+12-s>window.innerHeight?(i.style.top=l.top-12-i.clientHeight+"px",n.addClass("m-select-d-box_bottom")):i.style.top=l.top+t+12+"px"},calcScrollBarPosition:function(){var e=this.get("dbox",null,!1),e=c(".m-select-d-box__list-container",e).get(0),t=(this.get("multiple",null,!1)?this.getHoveredItems():this.getSelectedItems())[0];if(t)return t=t.$elem.position().top+e.scrollTop,t<e.clientHeight/2?e.scrollTop=0:void(e.scrollTop=t-e.clientHeight/2)},_calcListContainerHeight:function(){var e,t=c(this.get("dbox",null,!1)).find(".m-select-d-box__list-container").get(0);if(this._isMobileState())return e=window.innerHeight/100,t.style.maxHeight=90*e-64-40+"px";t.style.maxHeight&&(t.style.maxHeight="")},_isDBoxElement:function(e){var t=this.get("dbox",null,!1);return!!c(t).find(e).length||t==e},_isTargetElement:function(e){var t=this.get("target",null,!1);return!!c(t).find(e).length||t==e},_isDBoxInput:function(e){return this.get("dbox_input")===e},_isMobileState:function(){return window.innerWidth<=640||window.innerWidth<=740&&this.fx.isHDensScreen()},_isBoxBottomState:function(){var e=this.get("dbox",null,null);return Boolean(e.className.match(new RegExp("m-select-d-box_bottom")))},_isColdInit:function(){return!this.instances.length},getHoveredItems:function(){var t=this.get("hoveredCache",null,!1);return Object.keys(t).map(function(e){return t[e]})},getSelectedKeys:function(){return Object.keys(this.get("selectedCache",null,!1))},getSelectedValues:function(){var t=this.get("selectedCache",null,!1);return Object.keys(t).map(function(e){return t[e].value})},getSelectedLabels:function(){var t=this.get("selectedCache",null,!1);return Object.keys(t).map(function(e){return t[e].label})},getSelectedItems:function(){var t=this.get("selectedCache",null,!1);return Object.keys(t).map(function(e){return t[e]})},hasValue:function(e){return!!this.get("valuesCache",null,!1)[e]},hasLabel:function(e){return!!this.get("labelsCache",null,!1)[e]},applySelectedToList:function(t){return t=t||this.get("list",null,!1),Object.keys(t).forEach(function(e){t[e]&&c.fn[t[e].selected?"addClass":"removeClass"].call([t[e].elem],"m-select-d-box__list-item_selected")}),this},applySelectedToInput:function(){var e=this.getSelectedValues(),t=this.getSelectedLabels(),i=this.get("target",null,!1),n=this.get("dbox_input",null,!1),l=(n.value=t.join("; ")+(t.length&&this.get("multiple")?";":""),i.tagName.toLowerCase());if("input"==l)this.fx.isTextInput(i)&&(i.value=n.value);else if("textarea"==l)i.value=t.join(";\n")+(t.length&&this.get("multiple")?";\n":"");else if("select"==l)for(var s=0;s<i.options.length;s++)i.options[s].selected=-1<c.inArray(i.options[s].value,e);return i.setAttribute("data-msdb-value",e.join(";")+(e.length&&this.get("multiple",null,!1)?";":"")),this},select:function(e){var t=this.getSelectedKeys();return this._select(e),this.applySelectedToList(this._getItemsByID(t.concat(this.getSelectedKeys()))),this.applySelectedToInput(),this},_select:function(e){if("object"==typeof e&&!c.isArray(e)){var t,i,n=!0;if("blank"in e&&(n=!!e.blank),"id"in e)this._selectByID(e.id,n);else{if("value"in e)t=e.value,i="value";else{if(!("label"in e))return;t=e.label,i="label"}if(t=[].concat(t),!this.get("multiple",null,!1)&&1<t.length)return null;"value"==i?this._selectByValue(t,n):"label"==i&&this._selectByLabel(t,n)}}},_selectByValue:function(e,t){t&&this._deselectAll();for(var i=this.get("valuesCache",null,!1),n=this.get("selectedCache",null,!1),l=0;l<e.length;l++)this.fx.hop(i,e[l])&&(i[e[l]].selected=!0,n[i[e[l]].id]=i[e[l]])},_selectByLabel:function(e,t){t&&this._deselectAll();for(var i=this.get("labelsCache",null,!1),n=this.get("selectedCache",null,!1),l=0;l<e.length;l++)this.fx.hop(i,e[l])&&(i[e[l]].selected=!0,n[i[e[l]].id]=i[e[l]])},deselect:function(e){var t=this.getSelectedKeys();return this._deselect(e),this.applySelectedToList(this._getItemsByID(t.concat(this.getSelectedKeys()))),this.applySelectedToInput(),this},_deselect:function(e){if(c.isPlainObject(e))return"value"in e?this._deselectByValue([].concat(e.value)):"label"in e?this._deselectByLabel([].concat(e.label)):void("id"in e&&this._deselectByID(e.id))},_deselectByValue:function(e){e=[].concat(e);for(var t,i,n=this.get("valuesCache",null,!1),l=this.get("selectedCache",null,!1),s=0;s<e.length;s++)t=e[s],this.fx.hop(n,t)&&(i=n[t].id,n[t].selected=!1,delete l[i])},_deselectByLabel:function(e){e=[].concat(e);for(var t,i,n=this.get("labelsCache",null,!1),l=this.get("selectedCache",null,!1),s=0;s<e.length;s++)t=e[s],this.fx.hop(n,t)&&(i=n[t].id,n[t].selected=!1,delete l[i])},_getItemsByID:function(e){for(var t=Object.create(null),i=this.get("list",null,!1),n=0;n<e.length;n++)t[e[n]]=i[e[n]];return t},hideItem:function(e){return e&&(this.get("hiddenCache",null,!1)[e.value]=e).$elem.addClass("m-select-d-box__list-item_hidden"),this},unhideItem:function(e){return e&&(delete this.get("hiddenCache",null,!1)[e.value],e.$elem.removeClass("m-select-d-box__list-item_hidden")),this},unhideAllItems:function(){var t=this.get("hiddenCache",null,!1);Object.keys(t).forEach(function(e){this.unhideItem(t[e])},this)},isVisibleItem:function(e){return!!e&&!e.$elem.hasClass("m-select-d-box__list-item_hidden")},hoverItem:function(e){if(!e)return this;var t=this.get("hoveredCache",null,!1);return e.isHovered=!0,e.$elem.addClass("m-select-d-box__list-item_hover"),t[e.id]=e,this},unhoverItem:function(e){if(!e)return this;var t=this.get("hoveredCache",null,!1);return e.isHovered=!1,e.$elem.removeClass("m-select-d-box__list-item_hover"),delete t[e.id],this},unhoverAllItems:function(){var t=this.get("hoveredCache",null,!1);return Object.keys(t).forEach(function(e){this.unhoverItem(t[e])},this),this},hoverNextVisibleItem:function(e){var t=this.getNextVisibleItem(e);return t&&(this.unhoverItem(e),this.hoverItem(t)),this},hoverPrevVisibleItem:function(e){var t=this.getPrevVisibleItem(e);return t&&(this.unhoverItem(e),this.hoverItem(t)),this},getNextVisibleItem:function(e){if(e&&e.next)return this.isVisibleItem(e.next)?e.next:this.getNextVisibleItem(e.next)},getPrevVisibleItem:function(e){if(e&&e.prev)return this.isVisibleItem(e.prev)?e.prev:this.getPrevVisibleItem(e.prev)},selectNextVisibleItem:function(e){var t;if(e)return t=this.getSelectedItems(),e=this.getNextVisibleItem(e),this._selectByID((e=e||arguments[0]).id,!0),this.applySelectedToInput(),this.applySelectedToList(t.concat(this.getSelectedItems())),e},selectPrevVisibleItem:function(e){var t;if(e)return t=this.getSelectedItems(),e=this.getPrevVisibleItem(e),this._selectByID((e=e||arguments[0]).id,!0),this.applySelectedToInput(),this.applySelectedToList(t.concat(this.getSelectedItems())),e},getLastVisibleItem:function(){var e=this.get("lastItem",null,!1);return this.isVisibleItem(e)&&e||this.getPrevVisibleItem(e)},getFirstVisibleItem:function(){var e=this.get("firstItem",null,!1);return this.isVisibleItem(e)&&e||this.getNextVisibleItem(e)},_selectByID:function(e,t){e=[].concat(e);var i,n=this.get("list",null,!1),l=this.get("selectedCache",null,!1);for(t&&this._deselectAll(),i=0;i<e.length;i++)n.hasOwnProperty(e[i])&&(n[e[i]].selected=!0,l[e[i]]=n[e[i]])},_deselectByID:function(e){e=[].concat(e);for(var t=this.get("list",null,!1),i=this.get("selectedCache",null,!1),n=0;n<e.length;n++)t.hasOwnProperty(e[n])&&(t[e[n]].selected=!1,delete i[e[n]])},_optionFiltersMatcher:function(e,t,i){if(arguments.length<3)return!0;if(!c.isArray(e="function"==typeof e?[e]:e))return!1;for(var n=0;n<e.length;n++)if(e[n].call(this,t,i))return!0;return!1},defaultOptionFilters:{default:function(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;e=new RegExp(e.toLowerCase().trim());return t=t.toString().toLowerCase(),Boolean(t.match(e))},russianKeyboard:function(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;for(var i={"`":"ё","~":"ё",q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"х","]":"ъ","}":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"э","'":"э",'"':"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"б",".":"ю",">":"ю"},n=e.toLowerCase().split(""),l=0,s=n.length;l<s;l++)i.hasOwnProperty(n[l])&&(n[l]=i[n[l]]);return this.defaultOptionFilters.default(n.join(""),t)}},applyAutoComplete:function(t){var i=this.get("list",null,!1),e=Object.keys(i),n=this.get("hiddenCache",null,!1),l=this.get("optionFilters",null,!1);return t?e.forEach(function(e){this._optionFiltersMatcher(l,t,i[e].label)?this.unhideItem(i[e]):this.hideItem(i[e])},this):this.unhideAllOpt(),Object.keys(n).length==e.length?this.trigger("autocomplete:empty"):this.trigger("autocomplete:not-empty"),this},deselectAll:function(){return this._deselectAll(),this.applySelectedToList(),this.applySelectedToInput(),this},_deselectAll:function(){var t=this.get("selectedCache",null,!1);Object.keys(t).forEach(function(e){t[e].selected=!1,delete t[e]})},selectAll:function(){if(!this.get("multiple",null,!1))return this;for(var e,t=this.get("selectedCache",null,!1),i=this.get("list",null,!1),n=Object.keys(i),l=0;l<n.length;l++)i[e=n[l]].selected=!0,t[e]=i[e];return this.applySelectedToList(),this.applySelectedToInput(),this},isActive:function(){var e=this.get("dbox",null,null);return 0==c(e).hasClass("m-select-d-box_hidden")},reInitList:function(){this._initList();this.get("list");for(var e,t=this.get("selectedCache",null,!1),i=this.get("valuesCache",null,!1),n=this.get("labelsCache",null,!1),l=this.get("hoveredCache",null,!1),s=Object.keys(t),o=0;o<s.length;o++)i[t[e=s[o]].value]&&n[t[e].label]?(t[e]=i[t[e].value],t[e].selected=!0):delete t[e];Object.keys(l).forEach(function(e){l.isHovered=!1,delete l[e]}),this.applySelectedToInput(),this.applySelectedToList()},close:function(){var e=this.get("dbox",null,!1);return c(e).addClass("m-select-d-box_hidden"),this._closeFade(),this.unhoverAllItems(),this},open:function(){var e=this.get("dbox",null,!1);return c(e).removeClass("m-select-d-box_hidden"),this.calcPosition(),this._openFade(),this._applyLang(this.get("language",null,!1)),this._isMobileState()&&this.get("dbox_input").focus(),this},_openFade:function(){c(this._globalElems.fade).removeClass("m-select-d-box_hidden")},_closeFade:function(){c(this._globalElems.fade).addClass("m-select-d-box_hidden")},destroy:function(){var t=this,e=this.get("target",null,0),i=Object.getPrototypeOf(this);e.removeAttribute("data-msdb-name"),e.removeAttribute("data-msdb-value"),this.set("target",void 0,null,!1),c(this.get("dbox")).remove(),i.instances=c.grep(i.instances,function(e){return e!=t})},fx:{isTextInput:function(e){if(e instanceof Node==!1)return!1;var t=e.tagName.toLowerCase();if("input"==t){if(e.type&&-1<c.inArray(e.type.toLowerCase(),["text","password","email","url","search","tel"]))return!0}else if("textarea"==t)return!0;return!1},isHDensScreen:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&1.3<window.devicePixelRatio||!1},isRetinaScreen:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)").matches)||window.devicePixelRatio&&2<=window.devicePixelRatio||!1},msplit:function(e,t){return(t=t.replace(new RegExp("["+e.join("")+"]","g"),e[0])).split(e[0])},trim:function(e,t,i){var n=[];return i&&"left"!=i||n.push("^["+t+"]+"),i&&"right"!=i||n.push("["+t+"]+$"),e.replace(new RegExp(n.join("|"),"g"),"")},rest:function(e,t){return"object"!=typeof e||"number"!=typeof t?[]:Array.prototype.slice.call(e,t)},hop:function(e,t){return"hasOwnProperty"in e?Object.prototype.hasOwnProperty.call(e,t):t in e}}}).unhoverAllOpt=o.prototype.unhoverAllItems,o.prototype.unhideAllOpt=o.prototype.unhideAllItems;var e,a={open:1,close:1,isActive:1,get:1,set:1,select:1,selectAll:1,deselectAll:1,on:1,trigger:1,getSelectedLabels:1,getSelectedValues:1,getSelectedKeys:1,getText:1,setText:1},r={open:1,close:1,set:1,select:1,selectAll:1,deselectAll:1,on:1,trigger:1,setText:1},t=c.fn.val;c.fn.extend({val:function(e){return this.attr("data-msdb-value")?e?this.mSelectDBox().select({value:e})&&this:this.mSelectDBox().getSelectedValues():t.apply(this,arguments)},mSelectDBox:function(e){if(this.length){for(var t,i=o.prototype.getInstances(),n=void 0,l=this[0],s=0;s<i.length;s++)if(i[s].get("target")==l){n=i[s];break}if(!arguments.length)return n;if("string"==typeof e){if(a[e]&&(t=o.prototype.fx.rest(arguments,1),"function"==typeof n[e]))return t=n[e].apply(n,t),r[e]?this:t}else if("object"==typeof e)return e.target=this[0],new o(e);return this}}}),c.prototype.mSelectDBox.prototype=o.prototype}(jQuery);